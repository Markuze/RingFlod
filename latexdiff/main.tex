%\documentclass[sigplan,review,anonymous]{acmart}
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL ../orig/main.tex   Mon Mar 15 13:34:55 2021
%DIF ADD main.tex           Mon Mar 15 13:18:48 2021
\documentclass[sigplan,10pt]{acmart}
%\acmSubmissionID{336}
%\renewcommand\footnotetextcopyrightpermission[1]{}
%\settopmatter{printacmref=false}
%\documentclass[letterpaper,twocolumn,10pt]{article}
%\usepackage{usenix2019_v3}
%\pagestyle{plain}

%DIF 10d10
%DIF < 
%DIF -------
\usepackage{color}
\usepackage{xspace}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage[english]{babel}
\usepackage{textcomp}
\usepackage{times}
\usepackage{amsmath}
\usepackage{setspace}
\usepackage[inline]{enumitem}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage[normalem]{ulem}
\usepackage{soul}
\usepackage{latexsym}
\usepackage{bbding}
\usepackage{pbox}
% to be able to draw some self-contained figs
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{fancyvrb}
\usepackage{listings}
\usepackage{adjustbox}
\usepackage{comment}
\usepackage{enumitem}
%striketrough
\usepackage[normalem]{ulem}
\usepackage{soul}
\usepackage{xspace}
\usepackage{enumitem,kantlipsum}

\usepackage{xcolor}
%\usepackage[dvipsnames]{xcolor}
\usepackage{adjustbox}
\usepackage{graphicx}
%\usepackage[table,xcdraw]{xcolor}

% inlined bib file
\usepackage{filecontents}

% break long urls
\usepackage{url}
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother


\providecommand{\data}{\textit{data}\xspace}
\providecommand{\shinfo}{\texttt{skb\_shared\_info}\xspace}
\providecommand{\skb}{\texttt{sk\_buff}\xspace}
\providecommand{\page}{\texttt{struct page}\xspace}
\providecommand{\uarg}{\texttt{ubuf\_info}\xspace}
\providecommand{\kva}{KVA\xspace}
\providecommand{\iova}{IOVA\xspace}
\providecommand{\mabaf}{malicious buffer\xspace}
\providecommand{\Mabaf}{Malicious buffer\xspace}
\providecommand{\spb}{SPB\-2\xspace}
\providecommand{\oportunity}{\textcolor{red}{Opportunity}\xspace}
\providecommand{\means}{\textcolor{red}{Means}\xspace}
\providecommand{\motivation}{\textcolor{red}{Motive}\xspace}
%\providecommand{\motivation}{\textit{Ma\-buff}\xspace}
\providecommand{\simple}{\textit{single-step}\xspace}
\providecommand{\Simple}{\textit{Single-step}\xspace}
\providecommand{\compound}{\textit{compound}\xspace}
\providecommand{\Compound}{\textit{Compound}\xspace}
\providecommand{\subpage}{sub-page\xspace}
\providecommand{\Subpage}{Sub-page\xspace}
%\providecommand{\tool}{SCAT\xspace}
\providecommand{\tool}{SPADE\xspace}
\providecommand{\dkasan}{D-KASAN\xspace}
\providecommand{\version}{5.0\xspace}
\providecommand{\latestversion}{5.6\xspace}

\newcommand{\SV}[1]{{\textcolor{red}{[Alex\&Shay:#1}]}} 
\newcommand{\adam}[1]{{\footnotesize\color{blue}[Adam: #1]}}

\newcommand{\X}{\textcolor{red}{\XSolidBrush}}
\newcommand{\V}{\textcolor{green}{\Checkmark}}
%BUFFER & ADDRESS & ACCESS
%-------------------------------------------------------------------------------
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFadd}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
\providecommand{\DIFmodbegin}{} %DIF PREAMBLE
\providecommand{\DIFmodend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
\newcommand{\DIFscaledelfig}{0.5}
%DIF HIGHLIGHTGRAPHICS PREAMBLE %DIF PREAMBLE
\RequirePackage{settobox} %DIF PREAMBLE
\RequirePackage{letltxmacro} %DIF PREAMBLE
\newsavebox{\DIFdelgraphicsbox} %DIF PREAMBLE
\newlength{\DIFdelgraphicswidth} %DIF PREAMBLE
\newlength{\DIFdelgraphicsheight} %DIF PREAMBLE
% store original definition of \includegraphics %DIF PREAMBLE
\LetLtxMacro{\DIFOincludegraphics}{\includegraphics} %DIF PREAMBLE
\newcommand{\DIFaddincludegraphics}[2][]{{\color{blue}\fbox{\DIFOincludegraphics[#1]{#2}}}} %DIF PREAMBLE
\newcommand{\DIFdelincludegraphics}[2][]{% %DIF PREAMBLE
\sbox{\DIFdelgraphicsbox}{\DIFOincludegraphics[#1]{#2}}% %DIF PREAMBLE
\settoboxwidth{\DIFdelgraphicswidth}{\DIFdelgraphicsbox} %DIF PREAMBLE
\settoboxtotalheight{\DIFdelgraphicsheight}{\DIFdelgraphicsbox} %DIF PREAMBLE
\scalebox{\DIFscaledelfig}{% %DIF PREAMBLE
\parbox[b]{\DIFdelgraphicswidth}{\usebox{\DIFdelgraphicsbox}\\[-\baselineskip] \rule{\DIFdelgraphicswidth}{0em}}\llap{\resizebox{\DIFdelgraphicswidth}{\DIFdelgraphicsheight}{% %DIF PREAMBLE
\setlength{\unitlength}{\DIFdelgraphicswidth}% %DIF PREAMBLE
\begin{picture}(1,1)% %DIF PREAMBLE
\thicklines\linethickness{2pt} %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\framebox(1,1){}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\line( 1,1){1}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,1){\line(1,-1){1}}}% %DIF PREAMBLE
\end{picture}% %DIF PREAMBLE
}\hspace*{3pt}}} %DIF PREAMBLE
} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbegin}{\DIFaddbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddend}{\DIFaddend} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbegin}{\DIFdelbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelend}{\DIFdelend} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbegin}{\DIFOaddbegin \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbegin}{\DIFOdelbegin \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbeginFL}{\DIFaddbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddendFL}{\DIFaddendFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbeginFL}{\DIFdelbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelendFL}{\DIFdelendFL} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbeginFL}{\DIFOaddbeginFL \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbeginFL}{\DIFOdelbeginFL \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
%DIF LISTINGS PREAMBLE %DIF PREAMBLE
\RequirePackage{listings} %DIF PREAMBLE
\RequirePackage{color} %DIF PREAMBLE
\lstdefinelanguage{DIFcode}{ %DIF PREAMBLE
%DIF DIFCODE_UNDERLINE %DIF PREAMBLE
  moredelim=[il][\color{red}\sout]{\%DIF\ <\ }, %DIF PREAMBLE
  moredelim=[il][\color{blue}\uwave]{\%DIF\ >\ } %DIF PREAMBLE
} %DIF PREAMBLE
\lstdefinestyle{DIFverbatimstyle}{ %DIF PREAMBLE
	language=DIFcode, %DIF PREAMBLE
	basicstyle=\ttfamily, %DIF PREAMBLE
	columns=fullflexible, %DIF PREAMBLE
	keepspaces=true %DIF PREAMBLE
} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim}{\lstset{style=DIFverbatimstyle}}{} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim*}{\lstset{style=DIFverbatimstyle,showspaces=true}}{} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}
%-------------------------------------------------------------------------------
\acmYear{2021}\copyrightyear{2021}
\setcopyright{acmlicensed}
\acmConference[EuroSys '21]{Sixteenth European Conference on Computer Systems}{April 26--29, 2021}{Online, United Kingdom}
\acmBooktitle{Sixteenth European Conference on Computer Systems (EuroSys '21), April 26--29, 2021, Online, United Kingdom}
\acmPrice{15.00}
\acmDOI{10.1145/3447786.3456249}
\acmISBN{978-1-4503-8334-9/21/04}

%don't want date printed
%\date{}

% make title bold and 14 pt font (Latex default is non-bold, 16 pt)
%\title{\Large \bf Motive, Means \& Opportunity: The Anatomy of DMA Attacks}
%\title{\Large \bf The Anatomy of IOMMU subverting DMA Attacks}

%\title{Understanding DMA Attacks in the Presence of an IOMMU}
\title[Characterizing, Exploiting, and Detecting DMA Code Injection Vulnerabilities]{Characterizing, Exploiting, and Detecting DMA Code Injection Vulnerabilities in the Presence of an IOMMU}
%\title{\Large \bf Endemic Weakness in DMA I/O: The Anatomy of DMA Attacks}
%\title{\Large \bf Systematizing DMA Vulnerabilities}
%\title{\Large \bf Endemic Weakness in DMA I/O: Systematizing DMA Vulnerabilities}

%\author{Markuze Alex$^{\dagger,\diamond}$}
%\author{Shay Vargaftik}
%\affiliation{VMware Research}
%\author{Gil Kupfer}
%\author{Boris Pismeny}

%\affiliation{\institution{$^{\dagger}$Technion -- Israel Institute of Technology}}
%\affiliation{\institution{$^{\diamond}$VMware}}
%\affiliation{\institution{$^{\ddagger}$Tel Aviv University }}
%\affiliation{Technion -- Israel Institute of Technology}
% % USENIX Security has double blind submissions
 \author{%
   Alex Markuze$^{\dagger,\diamond}$   \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
   Shay Vargaftik$^{\diamond}$   \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
   Gil Kupfer$^{\dagger}$   \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
   Boris Pismeny$^{\dagger}$\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
   Nadav Amit$^{\diamond}$   \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
   Adam Morrison$^{\ddagger}$ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \
   Dan Tsafrir$^{\dagger,\diamond}$
 }
\affiliation{
   \institution{%
     \ \\[-2mm]
     $^{\dagger}$Technion -- Israel Institute of Technology
     \ \ \ \ \ \ \ \ \ \ \ \ \ 
     $^{\ddagger}$Tel Aviv University 
     \ \ \ \ \ \ \ \ \ \ \ \ \ 
     $^{\diamond}$VMware\\
     \ \\
}}

\renewcommand{\shortauthors}{Markuze, Vargaftik, Kupfer, Pismeny, Amit, Morrison, and Tsafrir}
  %\gdef\authors{Alex Markuze, Shay Vargaftik, Gil Kupfer, Boris Pismeny, Nadav Amit, Adam Morrison, and Dan Tsafrir}
% \begin{comment}
%\author{ 
%    {Markuze Alex Technion, VMware Research}
    %\and
    %{Shay Vargaftik}\\VMware Research
%}
%{\rm Markuze Alex}\\
%Technion, VMware Research \\
%}
% \and
% {\rm Shay Vargaftik}\\
% VMware Research \\
% \and
% {\rm Gil Kupfer}\\
% Technion \\
% \and
% {\rm Nadav Amit}\\
% VMware Research
% \and
% {\rm Dan Tsafrir}\\
% Technion, VMware Research \\} % end author
% \end{comment}

%\maketitle
%-------------------------------------------------------------------------------
\begin{abstract}
%-------------------------------------------------------------------------------
%\textcolor{red}{Before: chaos Now Oder == MMO, taxonomy of DMA vulnerabilities Result \compound attacks. + tool. We expose  a deep-rooted issue in OS design rather than ad-hoc buggies... The language:\simple vs. \compound, MMO, \subpage types.}


Direct Memory Access (DMA) makes the system vulnerable to DMA attacks, in which I/O devices access memory regions not intended for their use. Hardware IOMMU protection cannot prevent all DMA attacks because it restricts DMA at page-level granularity leading to \subpage vulnerabilities. 

Currently, known DMA attacks rely on simple situations in which write access to a kernel pointer is obtained due to \subpage vulnerabilities and all other attack ingredients are available and reside on the same page. 
However, this paper shows that DMA vulnerabilities are a deep-rooted issue where it is often the kernel design that enables complex and multistage DMA attacks.  
In this paper, we seek to provide a structured top-down approach \mbox{to characterize, exploit, and detect them.}



%Conventional wisdom is that \subpage vulnerabilities that lead to viable DMA attacks are made possible by buggy device drivers or poor (but isolated) driver design choices.

%This paper disproves the above belief, showing that it is often the kernel design that enables a DMA attack. 

%This paper shows that it is often the kernel design choices that facilitate a DMA attack. 
To this end, we first categorize \subpage vulnerabilities into four categories, providing insight into the structure of DMA vulnerabilities. 
Then, to exploit these vulnerabilities, we identify a set of three vulnerability attributes which are sufficient to execute code injection attacks. 

We then build analysis tools that detect \subpage vulnerabilities and analyze the Linux kernel. 
We find that 72\% of the device drivers expose sensitive callback pointers, which may be overwritten by a device to hijack kernel control flow.

Aided by the tools' output, we demonstrate novel code injection attacks on the Linux kernel we term \compound{} attacks.
Specifically, while all previously reported attacks are \emph{single-step}, i.e., with the vulnerability attributes present in a single page, in \compound{} attacks, the vulnerability attributes are initially incomplete. However, they can be attained by carefully exploiting standard OS behavior.

Finally, our code is publicly available \cite{DKASAN,SPADE}.

\end{abstract}
\maketitle

%-------------------------------------------------------------------------------
%-------------------------------------------------------------------------------

\input{intro}
\input{background}
\input{os_defences}
\input{attack_mechanics}
\input{tool}
\input{dma_kasan}
\input{linux_net}
\input{appendixes/more_attacks}
\input{setup}
\input{other_os}
\input{related_work}
\input{conclusion}

\begin{acks}
%This work was funded in part by ISF under grant 2005/17 and Blavatnik ICRC at TAU.
This work was funded in part by ISF under grant 2005/17, Blavatnik ICRC at TAU, Technion Hiroshi Fujiwara Cyber Security Research Center, the Israel National Cyber Directorate, and VMware Research.
\end{acks}


\bibliographystyle{plain}
\bibliography{references}

%\appendix

%\input{appendixes/shellcode}
%\input{appendixes/dma_bidir.tex}
%\input{appendixes/more_attacks}
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
